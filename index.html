<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculateur Textile ALTICONCEPTION</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #106368, #55cf9b);
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 30px;
    }
    .container {
      background: linear-gradient(135deg, #106368, #55cf9b);
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 8px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      width: 100%;
      max-width: 400px;
      animation: fadeIn 1.0s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: white;
    }
    select, input[type="number"], input[type="text"], input[type="email"], input[type="tel"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1em;
      box-sizing: border-box;
    }
    .marquage-buttons button {
      display: inline-block;
      margin: 5px 5px 0 0;
      padding: 10px 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #ecf0f1;
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.2s;
    }
    .marquage-buttons button.selected {
      background-color: #2980b9;
      color: white;
      border-color: #1c5980;
    }
    button.calculate, button#download-pdf {
      background-color: #2980b9;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1em;
      width: 100%;
      margin-top: 10px;
      transition: background-color 0.3s, transform 0.2s;
    }
    button.calculate:hover, button#download-pdf:hover {
      background-color: #1c5980;
      transform: scale(1.05);
    }
    .result {
      font-size: 0,9em;
      margin-top: 20px;
      font-weight: 700;
      color: #2c3e50;
      background: #e8f8f5;
      padding: 20px;
      border-radius: 10px;
      box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
      white-space: pre-line;
      animation: fadeIn 0.8s ease-in-out;
    }
  </style>
</head>
<body>
    <img src="https://raw.githubusercontent.com/clem141100/TARIFS-ALTICONCEPTION/main/logo1.png" alt="Logo ALTICONCEPTION" style="max-width:300px; display:block; margin: 0 auto 20px;" />
  <div class="container">
    <div class="form-group">
      <label for="clientName">Nom du client</label>
      <input type="text" id="clientName" placeholder="Entrez le nom du client" />
    </div>
    <div class="form-group">
      <label for="clientEmail">Adresse mail (facultatif)</label>
      <input type="email" id="clientEmail" placeholder="Entrez l'adresse mail" />
    </div>
    <div class="form-group">
      <label for="clientPhone">T√©l√©phone (facultatif)</label>
      <input type="tel" id="clientPhone" placeholder="Entrez le num√©ro de t√©l√©phone" />
    </div>
    <div class="form-group">
      <label for="article">Article</label>
      <select id="article">
       <option value="16.90" data-name="ATF T-shirt Leon 150 Blanc 3272">ATF T-shirt Leon 150 Blanc 3272</option>
<option value="16.90" data-name="ATF T-shirt Leon 150 3272">ATF T-shirt Leon 150 3272</option>
<option value="17.90" data-name="ATF T-shirt Sacha 170 Blanc 3888">ATF T-shirt Sacha 170 Blanc 3888</option>
<option value="17.90" data-name="ATF T-shirt Sacha 170 3888">ATF T-shirt Sacha 170 3888</option>
<option value="21.90" data-name="ATF Polo Pierrot 220 Blanc 4330">ATF Polo Pierrot 220 Blanc 4330</option>
<option value="22.90" data-name="ATF Polo Pierrot 220 Marine 4330">ATF Polo Pierrot 220 Marine 4330</option>
<option value="10.00" data-name="Sol's 150 Regent Blanc 11380">Sol's 150 Regent Blanc 11380</option>
<option value="10.00" data-name="Sol's 150 Regent 11380">Sol's 150 Regent 11380</option>
<option value="11.50" data-name="Sol's 190 imperial Blanc 11500">Sol's 190 imperial Blanc 11500</option>
<option value="11.50" data-name="Sol's 190 Imperial 11500">Sol's 190 Imperial 11500</option>
<option value="16.60" data-name="Polo l√©ger W460">Polo l√©ger W460</option>
<option value="15.00" data-name="Polo Sol's 210 Pacific Blanc 4439">Polo Sol's 210 Pacific Blanc 4439</option>
<option value="15.00" data-name="Polo Sol's 210 Pacific 4439">Polo Sol's 210 Pacific 4439</option>
<option value="14.50" data-name="Polo Sol's 180 Perfect Blanc 11346">Polo Sol's 180 Perfect Blanc 11346</option>
<option value="14.50" data-name="Polo Sol's 180 Perfect 11346">Polo Sol's 180 Perfect 11346</option>
<option value="11.50" data-name="Sport monocouleur JC001">Sport monocouleur JC001</option>
<option value="12.75" data-name="Sport Bicolor JC003">Sport Bicolor JC003</option>
<option value="14.50" data-name="Oversize 240g BY102">Oversize 240g BY102</option>
<option value="16.00" data-name="Pull Manche longue F304">Pull Manche longue F304</option>
<option value="24.50" data-name="Sweat Zipp√© Sol's Stone 260 Blanc 1714">Sweat Zipp√© Sol's Stone 260 Blanc 1714</option>
<option value="24.50" data-name="Sweat Zipp√© Sol's Stone 260 1714">Sweat Zipp√© Sol's Stone 260 1714</option>
<option value="19.50" data-name="Sweat √† capuche Sol's Snake 280 Blanc 47101">Sweat √† capuche Sol's Snake 280 Blanc 47101</option>
<option value="19.50" data-name="Sweat √† capuche Sol's Snake 280 47101">Sweat √† capuche Sol's Snake 280 47101</option>
<option value="26.90" data-name="Doudounne SM Sol's Stream 280 4020">Doudounne SM Sol's Stream 280 4020</option>
<option value="15.20" data-name="Tablier de cuisine X1012">Tablier de cuisine X1012</option>
<option value="10.00" data-name="Casquette grillage 1668">Casquette grillage 1668</option>
<option value="9.00" data-name="Casquette Standard 594">Casquette Standard 594</option>
      </select>
    </div>
    <div class="form-group">
      <label>Marquages</label>
      <div class="marquage-buttons" id="marquage-buttons">
        <button data-value="4.00" data-name="C≈ìur">C≈ìur</button>
        <button data-value="4.00" data-name="Oppos√© au c≈ìur">Oppos√© au c≈ìur</button>
        <button data-value="6.50" data-name="Centre torse">Centre torse</button>
        <button data-value="4.50" data-name="Haut dos">Haut dos</button>
        <button data-value="6.50" data-name="Centre dos">Centre dos</button>
        <button data-value="4.00" data-name="Manche droite">Manche droite</button>
 	<button data-value="4.00" data-name="Manche gauche">Manche gauche</button>
        <button data-value="5.00" data-name="Manche longue droite">Manche longue droite</button>
	<button data-value="5.00" data-name="Manche longue gauche">Manche longue gauche</button>
        <button data-value="5.00" data-name="Couvre chef avant">Couvre chef avant</button>
	<button data-value="5.00" data-name="Couvre chef lat√©ral">Couvre chef lat√©ral</button>
        <button data-value="11.50" data-name="Coeur Broderie">Coeur broderie</button>
	<button data-value="16.50" data-name="Haut du dos broderie">Haut du dos broderie</button>
      </div>
    </div>
    <div class="form-group">
      <label for="quantite">Quantit√© d'articles</label>
      <input type="number" id="quantite" value="1" min="1" />
    </div>
    <button class="calculate" onclick="calculerPrix()">üßÆ Calculer le prix</button>
    <div class="result" id="resultat"></div>
    <button id="download-pdf" style="display:none;" onclick="telechargerPDF()">‚¨áÔ∏è T√©l√©charger le devis PDF</button>
  </div>

  <!-- jsPDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;

    const boutonsMarquage = document.querySelectorAll("#marquage-buttons button");
    boutonsMarquage.forEach(btn => {
      btn.addEventListener("click", () => {
        btn.classList.toggle("selected");
      });
    });

    let dernierDevis = null;

    function genererNumeroDevis() {
      const now = new Date();
      return 'ALT-' + now.getFullYear() + '-' + now.getTime().toString().slice(-6);
    }

    function getRemiseQuantite(qte) {
      if (qte >= 250) return 0.20;
      if (qte >= 100) return 0.15;
      if (qte >= 40) return 0.10;
      if (qte >= 10) return 0.05;
      if (qte >= 5) return 0.03;
      return 0;
    }

    function getRemiseMarquages(n) {
      switch(n) {
        case 5: return 0.15;
        case 4: return 0.13;
        case 3: return 0.07;
        case 2: return 0.03;
        case 1: return 0;
        default: return 0;
      }
    }

    function calculerPrix() {
      const clientName = document.getElementById("clientName").value.trim();
      if (!clientName) {
        alert("Merci d'entrer le nom du client.");
        return;
      }

      const articleSelect = document.getElementById("article");
      const articlePrixHT = parseFloat(articleSelect.value);
      const articleNom = articleSelect.options[articleSelect.selectedIndex].dataset.name;

      const quantite = parseInt(document.getElementById("quantite").value);
      if (quantite < 1 || isNaN(quantite)) {
        alert("La quantit√© doit √™tre au moins 1.");
        return;
      }

      const marquages = document.querySelectorAll("#marquage-buttons button.selected");
      let totalMarquagesHT = 0;
      let marquagesNoms = [];
      marquages.forEach(m => {
        totalMarquagesHT += parseFloat(m.dataset.value);
        marquagesNoms.push(m.dataset.name);
      });

      const nombreMarquages = marquagesNoms.length;

      const prixUnitaireSansRemise = articlePrixHT + totalMarquagesHT;

      // Calcul remises cumul√©es
      const remiseQuantite = getRemiseQuantite(quantite);
      const remiseMarquages = getRemiseMarquages(nombreMarquages);

      // Cumul des remises
      const remiseTotale = remiseQuantite + remiseMarquages;

      // Appliquer remise cumul√©e (par exemple 3% + 5% = 8%)
      // Le prix unitaire avec remise
      const prixUnitaireHT = prixUnitaireSansRemise * (1 - remiseTotale);

      const TVA = 0.20;

      const totalHT = prixUnitaireHT * quantite;
      const totalTVA = totalHT * TVA;
      const totalTTC = totalHT + totalTVA;

      // R√©cup√©rer mail et t√©l√©phone (facultatifs)
      const clientEmail = document.getElementById("clientEmail").value.trim();
      const clientPhone = document.getElementById("clientPhone").value.trim();

      dernierDevis = {
        clientName,
        clientEmail,
        clientPhone,
        articleNom,
        quantite,
        marquagesNoms,
        prixUnitaireHT,
        totalHT,
        TVA,
        totalTVA,
        totalTTC,
        numeroDevis: genererNumeroDevis(),
        dateDevis: new Date()
      };

      document.getElementById("resultat").innerHTML =
        `Prix unitaire HT : <strong>${prixUnitaireHT.toFixed(2)} ‚Ç¨</strong>\n` +
        `Total HT (${quantite} article(s)) : <strong>${totalHT.toFixed(2)} ‚Ç¨</strong>\n` +
        `TVA (20%) : <strong>${totalTVA.toFixed(2)} ‚Ç¨</strong>\n` +
        `Total TTC : <strong>${totalTTC.toFixed(2)} ‚Ç¨</strong>`;

      document.getElementById("download-pdf").style.display = "block";
    }

    function telechargerPDF() {
  const doc = new jsPDF();
  let currentY = 15;

  // Ajouter le logo (charg√© dynamiquement)
  const logoImg = new Image();
  logoImg.src = "https://raw.githubusercontent.com/clem141100/TARIFS-ALTICONCEPTION/main/logo1.png";
  logoImg.onload = () => {
    doc.addImage(logoImg, "PNG", 15, currentY, 40, 20);
    currentY += 25;

    finalizePDF(doc, currentY);
  };
}

function finalizePDF(doc, currentY) {
  const today = new Date().toLocaleDateString("fr-FR");

  // Titre
  doc.setFont("helvetica", "bold");
  doc.setFontSize(18);
  doc.text("Devis", 105, currentY, { align: "center" });
  currentY += 10;

  // Infos client
  doc.setFontSize(11);
  doc.setFont("helvetica", "normal");
  doc.text(`Client : ${client}`, 15, currentY);
  currentY += 5;
  doc.text(`Produit : ${produit}`, 15, currentY);
  currentY += 10;

  // Tableau devis
  doc.setFont("helvetica", "bold");
  doc.setFontSize(12);
  doc.text("D√©tail", 15, currentY);
  currentY += 7;

  doc.setFont("helvetica", "normal");
  doc.setFontSize(11);
  doc.text(`Quantit√© : ${quantite}`, 15, currentY);
  currentY += 7;

  doc.text(`Prix unitaire HT : ${prixUnitaireHT.toFixed(2)} ‚Ç¨`, 15, currentY);
  currentY += 7;

  // Marquages
  if (marquages.length > 0) {
    doc.text(`Marquages :`, 15, currentY);
    currentY += 6;
    marquages.forEach((marquage) => {
      doc.text(`- ${marquage.nom} : ${marquage.prix.toFixed(2)} ‚Ç¨`, 20, currentY);
      currentY += 5;
    });
  }

  currentY += 5;

  // Remises
  doc.setFont("helvetica", "bold");
  doc.text("Remises :", 15, currentY);
  currentY += 6;
  doc.setFont("helvetica", "normal");
  if (remiseQuantite > 0) {
    doc.text(`- Remise quantit√© : ${remiseQuantite.toFixed(0)} %`, 20, currentY);
    currentY += 5;
  }
  if (remiseMarquages > 0) {
    doc.text(`- Remise marquages : ${remiseMarquages.toFixed(0)} %`, 20, currentY);
    currentY += 5;
  }
  if (remiseTotale > 0) {
    doc.setFont("helvetica", "bold");
    doc.text(`Total remises : -${remiseTotale.toFixed(0)} %`, 20, currentY);
    doc.setFont("helvetica", "normal");
    currentY += 7;
  }

  // Totaux
  doc.setFont("helvetica", "bold");
  doc.text("Total HT : " + totalHT.toFixed(2) + " ‚Ç¨", 15, currentY);
  currentY += 7;

  doc.setTextColor(39, 174, 96); // vert
  doc.text("Total TTC : " + totalTTC.toFixed(2) + " ‚Ç¨", 15, currentY);
  doc.setTextColor(0, 0, 0); // noir
  currentY += 15;

  // Mention l√©gale
  doc.setFontSize(10);
  doc.text("TVA non applicable, art. 293B du CGI", 15, currentY);
  currentY += 10;

  // Date
  doc.text(`Date : ${today}`, 15, currentY);
  currentY += 20;

  // Pied de page
  doc.setFontSize(9);
  doc.setTextColor(150);
  doc.text("ALTICONCEPTION - contact@alticonception.fr - www.alticonception.fr", 15, 285);

  // T√©l√©charger le PDF
  doc.save(`Devis_${client.replace(/\s+/g, "_")}.pdf`);
}
    }
  </script>
</body>
</html>
