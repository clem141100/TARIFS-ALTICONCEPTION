<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculateur Textile ALTICONCEPTION</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #106368, #55cf9b);
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 30px;
    }
    .container {
      background: linear-gradient(135deg, #106368, #55cf9b);
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 8px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      width: 100%;
      max-width: 400px;
      animation: fadeIn 1.0s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: white;
    }
    select, input[type="number"], input[type="text"], input[type="email"], input[type="tel"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1em;
      box-sizing: border-box;
    }
    .marquage-category-buttons button {
      display: inline-block;
      margin: 5px 5px 0 0;
      padding: 10px 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #ecf0f1;
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.2s;
    }
    .marquage-category-buttons button.selected {
      background-color: #2980b9;
      color: white;
      border-color: #1c5980;
    }
    .marquage-buttons button {
      display: inline-block;
      margin: 5px 5px 0 0;
      padding: 10px 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #ecf0f1;
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.2s;
    }
    .marquage-buttons button.selected {
      background-color: #2980b9;
      color: white;
      border-color: #1c5980;
    }
    button.calculate, button#download-pdf, button#add-article, button.delete-article, button#download-invoice {
      background-color: #2980b9;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1em;
      width: 100%;
      margin-top: 10px;
      transition: background-color 0.3s, transform 0.2s;
    }
    button.calculate:hover, button#download-pdf:hover, button#add-article:hover, button.delete-article:hover, button#download-invoice:hover {
      background-color: #1c5980;
      transform: scale(1.05);
    }
    .result {
      font-size: 0.9em;
      margin-top: 20px;
      font-weight: 700;
      color: #2c3e50;
      background: #e8f8f5;
      padding: 20px;
      border-radius: 10px;
      box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
      white-space: pre-line;
      animation: fadeIn 0.8s ease-in-out;
    }
    .article {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      background-color: rgba(255, 255, 255, 0.5);
    }
    .article-result {
      font-size: 0.9em;
      margin-top: 10px;
      font-weight: 700;
      color: #2c3e50;
      background: #e8f8f5;
      padding: 10px;
      border-radius: 10px;
      box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
      white-space: pre-line;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <img src="https://raw.githubusercontent.com/clem141100/TARIFS-ALTICONCEPTION/main/logo1.png" alt="Logo ALTICONCEPTION" style="max-width:300px; display:block; margin: 0 auto 20px;" />
  <div class="container">
    <div class="form-group">
      <label for="clientName">Nom du client</label>
      <input type="text" id="clientName" placeholder="Entrez le nom du client" />
    </div>
    <div class="form-group">
      <label for="clientEmail">Adresse mail (facultatif)</label>
      <input type="email" id="clientEmail" placeholder="Entrez l'adresse mail" />
    </div>
    <div class="form-group">
      <label for="clientPhone">T√©l√©phone (facultatif)</label>
      <input type="tel" id="clientPhone" placeholder="Entrez le num√©ro de t√©l√©phone" />
    </div>
    <div class="form-group">
      <label for="clientAddress">Adresse (facultatif)</label>
      <input type="text" id="clientAddress" placeholder="Entrez l'adresse" />
    </div>
    <div id="articles-container">
      <div class="article">
        <div class="form-group">
          <label for="article">Article</label>
          <select class="article-select">
            <option value="16.90" data-name="T-shirt Made in France 150g/m2">T-shirt Made in France 150g/m3</option>
            <option value="17.90" data-name="T-shirt Made in France 170g/m2">T-shirt Made in France 170g/m2</option>
            <option value="22.90" data-name="Polo Made in France 220g/m2">Polo Made in France 220g/m2</option>
            <option value="10.00" data-name="T-shirt 150g/m2">T-shirt 150g/m2</option>
            <option value="11.50" data-name="T-Shirt 190 g/m2">T-Shirt 190 g/m2</option>
            <option value="15.00" data-name="Polo 210g/m2">Polo 210g/m2</option>
            <option value="14.50" data-name="Polo 180g/m2">Polo 180g/m2</option>
            <option value="11.50" data-name="T-shirt Sport monocouleur">T-shirt Sport monocouleur</option>
            <option value="12.75" data-name="T-shirt Sport bicolor">T-shirt Sport bicolor</option>
            <option value="14.50" data-name="T-shirt Oversize 240g/m2">T-shirt Oversize 240g/m2</option>
            <option value="24.50" data-name="Sweat √† capuche Zipp√© 260g/m2">Sweat √† capuche Zipp√© 260g/m2</option>
            <option value="19.50" data-name="Sweat √† capuche 280g/m2">Sweat √† capuche 280g/m2</option>
            <option value="26.90" data-name="Doudoune sans manche 280g/m2">Doudoune sans manche 280g/m2</option>
	    <option value="28.90" data-name="Veste zipp√©e 270g/m2">Veste zipp√©e 270g/m2</option>
            <option value="15.20" data-name="Tablier de cuisine">Tablier de cuisine</option>
            <option value="10.00" data-name="Casquette grillag√©e">Casquette grillag√©e</option>
            <option value="9.00" data-name="Casquette Standard">Casquette Standard</option>
            <option value="8.50" data-name="Casquette enfant">Casquette enfant</option>
	    <option value="7.40" data-name="Bob Unisexe">Bob Unisexe</option>
          </select>
        </div>
        <div class="form-group">
          <label for="custom-article">Nom de l'article personnalis√©</label>
          <input type="text" class="custom-article-name" placeholder="Entrez le nom de l'article" />
        </div>
        <div class="form-group">
          <label for="custom-price">Prix personnalis√©</label>
          <input type="number" class="custom-article-price" placeholder="Entrez le prix" step="0.01" />
        </div>
        <div class="form-group">
          <label for="color">Couleur</label>
          <input type="text" class="color" placeholder="Entrez la couleur" />
        </div>
        <div class="form-group">
          <label>Cat√©gorie de Marquage</label>
          <div class="marquage-category-buttons">
            <button data-category="dtf" class="selected">DTF</button>
            <button data-category="serigraphie">S√©rigraphie</button>
            <button data-category="broderie">Broderie</button>
            <button data-category="patch-brode">Patch brod√©</button>
          </div>
        </div>
        <div class="form-group">
          <label>Marquages</label>
          <div class="marquage-buttons">
            <div class="marquage-buttons-dtf">
              <button data-value="4.00" data-name="C≈ìur DTF">C≈ìur</button>
              <button data-value="4.00" data-name="Oppos√© au c≈ìur DTF">Oppos√© au c≈ìur</button>
              <button data-value="6.50" data-name="Centre torse DTF">Centre torse</button>
              <button data-value="4.50" data-name="Haut dos DTF">Haut dos</button>
              <button data-value="6.50" data-name="Centre dos DTF">Centre dos</button>
              <button data-value="4.00" data-name="Manche droite DTF">Manche droite</button>
              <button data-value="4.00" data-name="Manche gauche DTF">Manche gauche</button>
              <button data-value="5.00" data-name="Manche longue droite DTF">Manche longue droite</button>
              <button data-value="5.00" data-name="Manche longue gauche DTF">Manche longue gauche</button>
              <button data-value="5.00" data-name="Couvre chef avant DTF">Couvre chef avant</button>
              <button data-value="5.00" data-name="Couvre chef lat√©ral DTF">Couvre chef lat√©ral</button>
            </div>
            <div class="marquage-buttons-serigraphie hidden">
              <button data-value="2.00" data-name="C≈ìur S√©rigraphie">C≈ìur</button>
              <button data-value="2.00" data-name="Oppos√© au c≈ìur S√©rigraphie">Oppos√© au c≈ìur</button>
              <button data-value="4.50" data-name="Centre torse S√©rigraphie">Centre torse</button>
              <button data-value="3.50" data-name="Haut dos S√©rigraphie">Haut dos</button>
              <button data-value="4.50" data-name="Centre dos S√©rigraphie">Centre dos</button>
              <button data-value="2.50" data-name="Manche droite S√©rigraphie">Manche droite</button>
              <button data-value="2.50" data-name="Manche gauche S√©rigraphie">Manche gauche</button>
              <button data-value="3.50" data-name="Manche longue droite S√©rigraphie">Manche longue droite</button>
              <button data-value="3.50" data-name="Manche longue gauche S√©rigraphie">Manche longue gauche</button>
            </div>
            <div class="marquage-buttons-patch-brode hidden">
              <button data-value="2.00" data-name="C≈ìur Patch brod√©">C≈ìur</button>
              <button data-value="2.00" data-name="Oppos√© au c≈ìur Patch brod√©">Oppos√© au c≈ìur</button>
              <button data-value="3.50" data-name="Haut dos Patch brod√©">Haut dos</button>
              <button data-value="2.50" data-name="Manche droite Patch brod√©">Manche droite</button>
              <button data-value="2.50" data-name="Manche gauche Patch brod√©">Manche gauche</button>
              <button data-value="15.00" data-name="Couvre chef avant Patch brod√©">Couvre chef avant</button>
            </div>
            <div class="marquage-buttons-broderie hidden">
              <button data-value="11.50" data-name="Coeur Broderie">Coeur</button>
              <button data-value="16.50" data-name="Haut du dos Broderie">Haut du dos</button>
              <button data-value="15.00" data-name="Couvre chef avant Broderie">Couvre chef avant</button>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="quantite">Quantit√© d'articles</label>
          <input type="number" class="quantite" value="1" min="1" />
        </div>
        <div class="article-result"></div>
        <button class="delete-article" onclick="supprimerArticle(this)">Supprimer cet article</button>
      </div>
    </div>
    <button id="add-article" onclick="ajouterArticle()">Ajouter un article</button>
    <button class="calculate" onclick="calculerPrix()">üßÆ Calculer le prix</button>
    <div class="result" id="resultat"></div>
    <button id="download-pdf" style="display:none;" onclick="telechargerPDF()">‚¨áÔ∏è T√©l√©charger le devis PDF</button>
    <button id="download-invoice" style="display:none;" onclick="telechargerFacture()">‚¨áÔ∏è T√©l√©charger la facture PDF</button>
  </div>
  <!-- jsPDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const { jsPDF } = window.jspdf;
    function showMarquageButtons(category, articleElement) {
      const marquageButtons = articleElement.querySelectorAll('.marquage-buttons > div');
      marquageButtons.forEach(div => {
        div.classList.add('hidden');
      });
      articleElement.querySelector(`.marquage-buttons-${category}`).classList.remove('hidden');
    }
    function ajouterArticle() {
      const container = document.getElementById('articles-container');
      const newArticle = document.createElement('div');
      newArticle.className = 'article';
      newArticle.innerHTML = `
        <div class="form-group">
          <label for="article">Article</label>
          <select class="article-select">
            <option value="16.90" data-name="T-shirt Made in France 150g/m2">T-shirt Made in France 150g/m3</option>
            <option value="17.90" data-name="T-shirt Made in France 170g/m2">T-shirt Made in France 170g/m2</option>
            <option value="22.90" data-name="Polo Made in France 220g/m2">Polo Made in France 220g/m2</option>
            <option value="10.00" data-name="T-shirt 150g/m2">T-shirt 150g/m2</option>
            <option value="11.50" data-name="T-Shirt 190 g/m2">T-Shirt 190 g/m2</option>
            <option value="15.00" data-name="Polo 210g/m2">Polo 210g/m2</option>
            <option value="14.50" data-name="Polo 180g/m2">Polo 180g/m2</option>
            <option value="11.50" data-name="T-shirt Sport monocouleur">T-shirt Sport monocouleur</option>
            <option value="12.75" data-name="T-shirt Sport bicolor">T-shirt Sport bicolor</option>
            <option value="14.50" data-name="T-shirt Oversize 240g/m2">T-shirt Oversize 240g/m2</option>
            <option value="24.50" data-name="Sweat √† capuche Zipp√© 260g/m2">Sweat √† capuche Zipp√© 260g/m2</option>
            <option value="19.50" data-name="Sweat √† capuche 280g/m2">Sweat √† capuche 280g/m2</option>
            <option value="26.90" data-name="Doudoune sans manche 280g/m2">Doudoune sans manche 280g/m2</option>
	    <option value="28.90" data-name="Veste zipp√©e 270g/m2">Veste zipp√©e 270g/m2</option>
            <option value="15.20" data-name="Tablier de cuisine">Tablier de cuisine</option>
            <option value="10.00" data-name="Casquette grillag√©e">Casquette grillag√©e</option>
            <option value="9.00" data-name="Casquette Standard">Casquette Standard</option>
            <option value="8.50" data-name="Casquette enfant">Casquette enfant</option>
	    <option value="7.40" data-name="Bob Unisexe">Bob Unisexe</option>
          </select>
        </div>
        <div class="form-group">
          <label for="custom-article">Nom de l'article personnalis√©</label>
          <input type="text" class="custom-article-name" placeholder="Entrez le nom de l'article" />
        </div>
        <div class="form-group">
          <label for="custom-price">Prix personnalis√©</label>
          <input type="number" class="custom-article-price" placeholder="Entrez le prix" step="0.01" />
        </div>
        <div class="form-group">
          <label for="color">Couleur</label>
          <input type="text" class="color" placeholder="Entrez la couleur" />
        </div>
        <div class="form-group">
          <label>Cat√©gorie de Marquage</label>
          <div class="marquage-category-buttons">
            <button data-category="dtf" class="selected">DTF</button>
            <button data-category="serigraphie">S√©rigraphie</button>
            <button data-category="broderie">Broderie</button>
            <button data-category="patch-brode">Patch brod√©</button>
          </div>
        </div>
        <div class="form-group">
          <label>Marquages</label>
          <div class="marquage-buttons">
            <div class="marquage-buttons-dtf">
              <button data-value="4.00" data-name="C≈ìur DTF">C≈ìur</button>
              <button data-value="4.00" data-name="Oppos√© au c≈ìur DTF">Oppos√© au c≈ìur</button>
              <button data-value="6.50" data-name="Centre torse DTF">Centre torse</button>
              <button data-value="4.50" data-name="Haut dos DTF">Haut dos</button>
              <button data-value="6.50" data-name="Centre dos DTF">Centre dos</button>
              <button data-value="4.00" data-name="Manche droite DTF">Manche droite</button>
              <button data-value="4.00" data-name="Manche gauche DTF">Manche gauche</button>
              <button data-value="5.00" data-name="Manche longue droite DTF">Manche longue droite</button>
              <button data-value="5.00" data-name="Manche longue gauche DTF">Manche longue gauche</button>
              <button data-value="5.00" data-name="Couvre chef avant DTF">Couvre chef avant</button>
              <button data-value="5.00" data-name="Couvre chef lat√©ral DTF">Couvre chef lat√©ral</button>
            </div>
            <div class="marquage-buttons-serigraphie hidden">
              <button data-value="2.00" data-name="C≈ìur S√©rigraphie">C≈ìur</button>
              <button data-value="2.00" data-name="Oppos√© au c≈ìur S√©rigraphie">Oppos√© au c≈ìur</button>
              <button data-value="4.50" data-name="Centre torse S√©rigraphie">Centre torse</button>
              <button data-value="3.50" data-name="Haut dos S√©rigraphie">Haut dos</button>
              <button data-value="4.50" data-name="Centre dos S√©rigraphie">Centre dos</button>
              <button data-value="2.50" data-name="Manche droite S√©rigraphie">Manche droite</button>
              <button data-value="2.50" data-name="Manche gauche S√©rigraphie">Manche gauche</button>
              <button data-value="3.50" data-name="Manche longue droite S√©rigraphie">Manche longue droite</button>
              <button data-value="3.50" data-name="Manche longue gauche S√©rigraphie">Manche longue gauche</button>
            </div>
            <div class="marquage-buttons-patch-brode hidden">
              <button data-value="2.00" data-name="C≈ìur Patch brod√©">C≈ìur</button>
              <button data-value="2.00" data-name="Oppos√© au c≈ìur Patch brod√©">Oppos√© au c≈ìur</button>
              <button data-value="3.50" data-name="Haut dos Patch brod√©">Haut dos</button>
              <button data-value="2.50" data-name="Manche droite Patch brod√©">Manche droite</button>
              <button data-value="2.50" data-name="Manche gauche Patch brod√©">Manche gauche</button>
              <button data-value="15.00" data-name="Couvre chef avant Patch brod√©">Couvre chef avant</button>
            </div>
            <div class="marquage-buttons-broderie hidden">
              <button data-value="11.50" data-name="Coeur Broderie">Coeur</button>
              <button data-value="16.50" data-name="Haut du dos Broderie">Haut du dos</button>
              <button data-value="15.00" data-name="Couvre chef avant Broderie">Couvre chef avant</button>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="quantite">Quantit√© d'articles</label>
          <input type="number" class="quantite" value="1" min="1" />
        </div>
        <div class="article-result"></div>
        <button class="delete-article" onclick="supprimerArticle(this)">Supprimer cet article</button>
      `;
      container.appendChild(newArticle);
      const categoryButtons = newArticle.querySelectorAll('.marquage-category-buttons button');
      categoryButtons.forEach(btn => {
        btn.addEventListener("click", function() {
          categoryButtons.forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
          showMarquageButtons(btn.dataset.category, newArticle);
        });
      });
      const marquageButtons = newArticle.querySelectorAll('.marquage-buttons button');
      marquageButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          btn.classList.toggle("selected");
        });
      });
    }
    function supprimerArticle(button) {
      const article = button.parentElement;
      article.parentElement.removeChild(article);
    }
    const categoryButtons = document.querySelectorAll('.marquage-category-buttons button');
    categoryButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        categoryButtons.forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        const article = btn.closest('.article');
        showMarquageButtons(btn.dataset.category, article);
      });
    });
    const marquageButtons = document.querySelectorAll(".marquage-buttons button");
    marquageButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        btn.classList.toggle("selected");
      });
    });
    let dernierDevis = null;
    function genererNumeroDevis() {
      const now = new Date();
      return 'ALT-' + now.getFullYear() + '-' + now.getTime().toString().slice(-6);
    }
    function getRemiseQuantite(qte) {
      if (qte >= 250) return 0.20;
      if (qte >= 100) return 0.15;
      if (qte >= 50) return 0.10;
      if (qte >= 10) return 0.05;
      if (qte >= 5) return 0.03;
      return 0;
    }
    function getRemiseMarquages(n) {
      switch(n) {
        case 5: return 0.15;
        case 4: return 0.13;
        case 3: return 0.07;
        case 2: return 0.03;
        case 1: return 0;
        default: return 0;
      }
    }
    function calculerPrix() {
      const clientName = document.getElementById("clientName").value.trim();
      if (!clientName) {
        alert("Merci d'entrer le nom du client.");
        return;
      }
      const articles = document.querySelectorAll('.article');
      let totalHT = 0;
      let totalTVA = 0;
      let totalTTC = 0;
      let details = [];
      articles.forEach(article => {
        const articleSelect = article.querySelector('.article-select');
        const customArticleName = article.querySelector('.custom-article-name').value.trim();
        const customArticlePrice = parseFloat(article.querySelector('.custom-article-price').value);
        const articlePrixHT = !isNaN(customArticlePrice) ? customArticlePrice : parseFloat(articleSelect.value);
        const articleNom = customArticleName || articleSelect.options[articleSelect.selectedIndex].dataset.name;
        const quantite = parseInt(article.querySelector('.quantite').value);
        const color = article.querySelector('.color').value;
        if (quantite < 1 || isNaN(quantite)) {
          alert("La quantit√© doit √™tre au moins 1.");
          return;
        }
        const marquages = article.querySelectorAll('.marquage-buttons button.selected');
        let totalMarquagesHT = 0;
        let marquagesNoms = [];
        marquages.forEach(m => {
          totalMarquagesHT += parseFloat(m.dataset.value);
          marquagesNoms.push(m.dataset.name);
        });
        const nombreMarquages = marquagesNoms.length;
        const prixUnitaireSansRemise = articlePrixHT + totalMarquagesHT;
        const remiseQuantite = getRemiseQuantite(quantite);
        const remiseMarquages = getRemiseMarquages(nombreMarquages);
        const remiseTotale = remiseQuantite + remiseMarquages;
        const prixUnitaireHT = prixUnitaireSansRemise * (1 - remiseTotale);
        const prixUnitaireTTC = prixUnitaireHT * 1.20;
        const TVA = 0.20;
        const totalHTArticle = prixUnitaireHT * quantite;
        const totalTVAArticle = totalHTArticle * TVA;
        const totalTTCArticle = totalHTArticle + totalTVAArticle;
        totalHT += totalHTArticle;
        totalTVA += totalTVAArticle;
        totalTTC += totalTTCArticle;
        details.push({
          articleNom,
          quantite,
          color,
          marquagesNoms,
          prixUnitaireHT,
          prixUnitaireTTC,
          totalHTArticle,
          totalTVAArticle,
          totalTTCArticle
        });
        const articleResult = article.querySelector('.article-result');
        articleResult.innerHTML = `
          Prix unitaire HT : <strong>${prixUnitaireHT.toFixed(2)} ‚Ç¨</strong><br>
          Prix unitaire TTC : <strong>${prixUnitaireTTC.toFixed(2)} ‚Ç¨</strong>
        `;
      });
      const clientEmail = document.getElementById("clientEmail").value.trim();
      const clientPhone = document.getElementById("clientPhone").value.trim();
      const clientAddress = document.getElementById("clientAddress").value.trim();
      dernierDevis = {
        clientName,
        clientEmail,
        clientPhone,
        clientAddress,
        details,
        totalHT,
        TVA: 0.20,
        totalTVA,
        totalTTC,
        numeroDevis: genererNumeroDevis(),
        dateDevis: new Date()
      };
      let resultatHTML = `Prix total HT : <strong>${totalHT.toFixed(2)} ‚Ç¨</strong>\n` +
        `TVA (20%) : <strong>${totalTVA.toFixed(2)} ‚Ç¨</strong>\n` +
        `Total TTC : <strong>${totalTTC.toFixed(2)} ‚Ç¨</strong>`;
      document.getElementById("resultat").innerHTML = resultatHTML;
      document.getElementById("download-pdf").style.display = "block";
      document.getElementById("download-invoice").style.display = "block";
    }
    function telechargerPDF() {
      if (!dernierDevis) {
        alert("Veuillez d'abord calculer le prix.");
        return;
      }
      const doc = new jsPDF();
      // Header
      doc.setFillColor(16, 98, 97);
      doc.roundedRect(10, 10, 190, 30, 3, 3, "F");
      doc.setFontSize(16);
      doc.setTextColor(255, 255, 255);
      doc.setFont("helvetica", "bold");
      doc.text("DEVIS", 20, 25);
      doc.setFontSize(12);
      doc.text(`N¬∞ ${dernierDevis.numeroDevis}`, 20, 35);
      doc.text(`Date: ${dernierDevis.dateDevis.toLocaleDateString("fr-FR")}`, 100, 25);
      doc.text(`Valide jusqu'au: ${new Date(dernierDevis.dateDevis.setMonth(dernierDevis.dateDevis.getMonth() + 1)).toLocaleDateString("fr-FR")}`, 100, 35);
      // Company and Client Info
      doc.setFontSize(10);
      doc.setTextColor(0, 0, 0);
      doc.setFont("helvetica", "normal");
      // Company Info
      doc.roundedRect(10, 50, 90, 40, 3, 3, "S");
      doc.text("ALTICONCEPTION", 15, 57);
      doc.text("By Novacom", 15, 62);
      doc.text("Route de la salaison", 15, 68);
      doc.text("43 290 Raucoules", 15, 74);
      doc.text("T√©l: +33 7 79 82 42 02 - +33 6 19 63 63 52", 15, 80);
      doc.text("Email: contact@alticonception-pro.fr", 15, 86);
      // Client Info
      doc.roundedRect(110, 50, 90, 40, 3, 3, "S");
      doc.text(dernierDevis.clientName, 115, 58);
      if (dernierDevis.clientEmail) {
        doc.text(dernierDevis.clientEmail, 115, 65);
      }
      if (dernierDevis.clientPhone) {
        doc.text(dernierDevis.clientPhone, 115, 72);
      }
      if (dernierDevis.clientAddress) {
        doc.text(dernierDevis.clientAddress, 115, 79);
      }
      // Table Header
      doc.setFontSize(10);
      doc.setFillColor(16, 98, 97);
      doc.roundedRect(10, 100, 190, 10, 3, 3, "F");
      doc.setTextColor(255, 255, 255);
      doc.text("Description", 20, 107);
      doc.text("PU HT(‚Ç¨)", 105, 107);
      doc.text("Quantit√©", 145, 107);
      doc.text("Total", 175, 107);
      // Table Content
      doc.setTextColor(0, 0, 0);
      doc.setFont("helvetica", "normal");
      let startY = 115;
      dernierDevis.details.forEach(detail => {
        doc.text(detail.articleNom, 20, startY);
        doc.text(`${detail.prixUnitaireHT.toFixed(2)} ‚Ç¨`, 105, startY);
        doc.text(detail.quantite.toString(), 145, startY);
        doc.text(`${detail.totalHTArticle.toFixed(2)} ‚Ç¨`, 175, startY);
        // Technique de marquage
        doc.text(`Technique: ${detail.marquagesNoms.join(", ")}`, 20, startY + 5);
        // Couleur
        doc.text(`Couleur: ${detail.color}`, 20, startY + 10);
        startY += 20;
      });
      // Total
      doc.setFont("helvetica", "bold");
      doc.text(`Total HT: ${dernierDevis.totalHT.toFixed(2)} ‚Ç¨`, 140, startY + 10);
      doc.text(`TVA (20%): ${dernierDevis.totalTVA.toFixed(2)} ‚Ç¨`, 140, startY + 20);
      doc.text(`Total TTC: ${dernierDevis.totalTTC.toFixed(2)} ‚Ç¨`, 140, startY + 30);
      // Payment Conditions
      doc.roundedRect(10, startY + 40, 90, 30, 3, 3, "S");
      doc.setFontSize(8);
      doc.text("Conditions de paiement:", 15, startY + 48);
      doc.text("30% d'acompte √† la commande, solde √† la livraison", 15, startY + 55);
      // Signature
      doc.roundedRect(110, startY + 40, 90, 30, 3, 3, "S");
      doc.text("Signature:", 115, startY + 48);
      // Company Full Info
      doc.setFontSize(8);
      const pageWidth = doc.internal.pageSize.getWidth();
      const pageHeight = doc.internal.pageSize.getHeight();
      const ligne1 = "NOVACOM - 21 rue de la salaison 43290 RAUCOULES FRANCE - Email : mathieuchaudierpro@gmail.com";
      const ligne2 = "Code NAF (APE) 7311Z - EURL au capital social de 0 ‚Ç¨ - Siret : 92839631600012";
      const bottomMargin = 10;
      const footerY1 = pageHeight - bottomMargin - 5;
      const footerY2 = pageHeight - bottomMargin;
      doc.setFontSize(8);
      doc.setTextColor(100); // gris doux
      doc.text(ligne1, pageWidth / 2, footerY1, { align: "center" });
      doc.text(ligne2, pageWidth / 2, footerY2, { align: "center" });
      doc.save(`Devis_${dernierDevis.numeroDevis}.pdf`);
    }
    function telechargerFacture() {
      if (!dernierDevis) {
        alert("Veuillez d'abord calculer le prix.");
        return;
      }
      const doc = new jsPDF();
      // Header
      doc.setFillColor(16, 98, 97);
      doc.roundedRect(10, 10, 190, 30, 3, 3, "F");
      doc.setFontSize(16);
      doc.setTextColor(255, 255, 255);
      doc.setFont("helvetica", "bold");
      doc.text("FACTURE", 20, 25);
      doc.setFontSize(12);
      doc.text(`N¬∞ ${dernierDevis.numeroDevis}`, 20, 35);
      doc.text(`Date: ${dernierDevis.dateDevis.toLocaleDateString("fr-FR")}`, 100, 25);
      // Company and Client Info
      doc.setFontSize(10);
      doc.setTextColor(0, 0, 0);
      doc.setFont("helvetica", "normal");
      // Company Info
      doc.roundedRect(10, 50, 90, 40, 3, 3, "S");
      doc.text("ALTICONCEPTION", 15, 57);
      doc.text("By Novacom", 15, 62);
      doc.text("Route de la salaison", 15, 68);
      doc.text("43 290 Raucoules", 15, 74);
      doc.text("T√©l: +33 7 79 82 42 02 - +33 6 19 63 63 52", 15, 80);
      doc.text("Email: contact@alticonception-pro.fr", 15, 86);
      // Client Info
      doc.roundedRect(110, 50, 90, 40, 3, 3, "S");
      doc.text(dernierDevis.clientName, 115, 58);
      if (dernierDevis.clientEmail) {
        doc.text(dernierDevis.clientEmail, 115, 65);
      }
      if (dernierDevis.clientPhone) {
        doc.text(dernierDevis.clientPhone, 115, 72);
      }
      if (dernierDevis.clientAddress) {
        doc.text(dernierDevis.clientAddress, 115, 79);
      }
      // Table Header
      doc.setFontSize(10);
      doc.setFillColor(16, 98, 97);
      doc.roundedRect(10, 100, 190, 10, 3, 3, "F");
      doc.setTextColor(255, 255, 255);
      doc.text("Description", 20, 107);
      doc.text("PU HT(‚Ç¨)", 105, 107);
      doc.text("Quantit√©", 145, 107);
      doc.text("Total", 175, 107);
      // Table Content
      doc.setTextColor(0, 0, 0);
      doc.setFont("helvetica", "normal");
      let startY = 115;
      dernierDevis.details.forEach(detail => {
        doc.text(detail.articleNom, 20, startY);
        doc.text(`${detail.prixUnitaireHT.toFixed(2)} ‚Ç¨`, 105, startY);
        doc.text(detail.quantite.toString(), 145, startY);
        doc.text(`${detail.totalHTArticle.toFixed(2)} ‚Ç¨`, 175, startY);
        // Technique de marquage
        doc.text(`Technique: ${detail.marquagesNoms.join(", ")}`, 20, startY + 5);
        // Couleur
        doc.text(`Couleur: ${detail.color}`, 20, startY + 10);
        startY += 20;
      });
      // Total
      doc.setFont("helvetica", "bold");
      doc.text(`Total HT: ${dernierDevis.totalHT.toFixed(2)} ‚Ç¨`, 140, startY + 10);
      doc.text(`TVA (20%): ${dernierDevis.totalTVA.toFixed(2)} ‚Ç¨`, 140, startY + 20);
      doc.text(`Total TTC: ${dernierDevis.totalTTC.toFixed(2)} ‚Ç¨`, 140, startY + 30);
      // Company Full Info
      doc.setFontSize(8);
      const pageWidth = doc.internal.pageSize.getWidth();
      const pageHeight = doc.internal.pageSize.getHeight();
      const ligne1 = "NOVACOM - 21 rue de la salaison 43290 RAUCOULES FRANCE - Email : mathieuchaudierpro@gmail.com";
      const ligne2 = "Code NAF (APE) 7311Z - EURL au capital social de 0 ‚Ç¨ - Siret : 92839631600012";
      const bottomMargin = 10;
      const footerY1 = pageHeight - bottomMargin - 5;
      const footerY2 = pageHeight - bottomMargin;
      doc.setFontSize(8);
      doc.setTextColor(100); // gris doux
      doc.text(ligne1, pageWidth / 2, footerY1, { align: "center" });
      doc.text(ligne2, pageWidth / 2, footerY2, { align: "center" });
      doc.save(`Facture_${dernierDevis.numeroDevis}.pdf`);
    }
  </script>
</body>
</html>
